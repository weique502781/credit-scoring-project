<!-- 预测结果页面 -->
{% extends "base.html" %}

{% block title %}Prediction Results - Credit Scoring System{% endblock %}

{% block extra_css %}
<style>
    .result-card {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border-radius: 15px;
        padding: 2rem;
        margin-bottom: 2rem;
        text-align: center;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
    }

    .probability-bars {
        display: flex;
        height: 40px;
        border-radius: 20px;
        overflow: hidden;
        margin: 2rem 0;
        background-color: rgba(255, 255, 255, 0.1);
    }

    .probability-bar {
        height: 100%;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-weight: 600;
        transition: all 1s ease-in-out;
    }

    .good-prob {
        background-color: #27ae60;
    }

    .bad-prob {
        background-color: #e74c3c;
    }

    .feature-value-card {
        background: white;
        border-radius: 8px;
        padding: 1rem;
        margin-bottom: 1rem;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        border-left: 4px solid #3498db;
    }

    .feature-category {
        background-color: #f8f9fa;
        border-radius: 8px;
        padding: 1rem;
        margin-bottom: 1.5rem;
    }

    .category-title {
        color: #2c3e50;
        font-weight: 600;
        margin-bottom: 1rem;
        padding-bottom: 0.5rem;
        border-bottom: 2px solid #dee2e6;
    }

    .risk-badge {
        font-size: 1.2rem;
        padding: 0.5rem 1.5rem;
        border-radius: 50px;
    }

    .prediction-icon {
        font-size: 4rem;
        margin-bottom: 1rem;
    }
</style>
{% endblock %}

{% block content %}
<!-- Prediction Results -->
<div class="row mb-4">
    <div class="col-12">
        <div class="result-card">
            <div class="prediction-icon">
                {% if result.prediction == 'Good Credit' %}
                <i class="fas fa-thumbs-up"></i>
                {% else %}
                <i class="fas fa-thumbs-down"></i>
                {% endif %}
            </div>

            <h2 class="display-4 mb-3">{{ result.prediction }}</h2>

            <div class="mb-4">
                <span class="risk-badge badge {% if result.prediction == 'Good Credit' %}bg-success{% else %}bg-danger{% endif %}">
                    {% if result.prediction == 'Good Credit' %}
                    <i class="fas fa-check-circle me-2"></i>Low Risk
                    {% else %}
                    <i class="fas fa-exclamation-triangle me-2"></i>High Risk
                    {% endif %}
                </span>
            </div>

            <div class="probability-bars">
                <div class="probability-bar good-prob" id="goodProbBar" style="width: 0%">
                    Good Credit: {{ result.probability_good }}
                </div>
                <div class="probability-bar bad-prob" id="badProbBar" style="width: 0%">
                    Bad Credit: {{ result.probability_bad }}
                </div>
            </div>

            <p class="lead mt-3">
                <i class="fas fa-brain me-2"></i>
                Prediction made using <strong>{{ result.model_used }}</strong>
            </p>
            <small class="text-light opacity-75">
                <i class="fas fa-clock me-1"></i>{{ result.timestamp }}
            </small>
        </div>
    </div>
</div>

<!-- Action Buttons -->
<div class="row mb-4">
    <div class="col-12">
        <div class="card">
            <div class="card-body">
                <h5 class="card-title mb-4">What would you like to do next?</h5>
                <div class="row">
                    <div class="col-md-4 mb-3">
                        <a href="{{ url_for('explain_method', method='lime') }}" class="btn btn-success w-100">
                            <i class="fas fa-search me-2"></i>Explain This Prediction
                        </a>
                        <p class="text-muted small mt-2">See why the model made this decision</p>
                    </div>
                    <div class="col-md-4 mb-3">
                        <a href="{{ url_for('predict_form') }}" class="btn btn-primary w-100">
                            <i class="fas fa-redo me-2"></i>Make Another Prediction
                        </a>
                        <p class="text-muted small mt-2">Try with different values</p>
                    </div>
                    <div class="col-md-4 mb-3">
                        <a href="{{ url_for('compare') }}" class="btn btn-warning w-100">
                            <i class="fas fa-chart-bar me-2"></i>Compare All Models
                        </a>
                        <p class="text-muted small mt-2">See how different models perform</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Input Summary -->
<div class="row">
    <div class="col-12">
        <div class="card">
            <div class="card-header bg-dark text-white">
                <h5 class="mb-0"><i class="fas fa-list-alt me-2"></i>Input Summary</h5>
            </div>
            <div class="card-body">
                <p class="text-muted mb-4">Below are the values you entered for this prediction:</p>

                <!-- Personal Information -->
                <div class="feature-category">
                    <h6 class="category-title">Personal Information</h6>
                    <div class="row">
                        <div class="col-md-3 mb-3">
                            <div class="feature-value-card">
                                <small class="text-muted">Age</small>
                                <div class="fw-bold">{{ original_values.age.description }}</div>
                            </div>
                        </div>
                        <div class="col-md-3 mb-3">
                            <div class="feature-value-card">
                                <small class="text-muted">Personal Status</small>
                                <div class="fw-bold">{{ original_values.personal_status.description }}</div>
                            </div>
                        </div>
                        <div class="col-md-3 mb-3">
                            <div class="feature-value-card">
                                <small class="text-muted">Job Type</small>
                                <div class="fw-bold">{{ original_values.job.description }}</div>
                            </div>
                        </div>
                        <div class="col-md-3 mb-3">
                            <div class="feature-value-card">
                                <small class="text-muted">Foreign Worker</small>
                                <div class="fw-bold">{{ original_values.foreign_worker.description }}</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Financial Information -->
                <div class="feature-category">
                    <h6 class="category-title">Financial Information</h6>
                    <div class="row">
                        <div class="col-md-3 mb-3">
                            <div class="feature-value-card">
                                <small class="text-muted">Checking Account</small>
                                <div class="fw-bold">{{ original_values.checking_account.description }}</div>
                            </div>
                        </div>
                        <div class="col-md-3 mb-3">
                            <div class="feature-value-card">
                                <small class="text-muted">Savings Account</small>
                                <div class="fw-bold">{{ original_values.savings.description }}</div>
                            </div>
                        </div>
                        <div class="col-md-2 mb-3">
                            <div class="feature-value-card">
                                <small class="text-muted">Credit Amount</small>
                                <div class="fw-bold">{{ original_values.amount.description }} DM</div>
                            </div>
                        </div>
                        <div class="col-md-2 mb-3">
                            <div class="feature-value-card">
                                <small class="text-muted">Loan Duration</small>
                                <div class="fw-bold">{{ original_values.duration.description }} months</div>
                            </div>
                        </div>
                        <div class="col-md-2 mb-3">
                            <div class="feature-value-card">
                                <small class="text-muted">Installment Rate</small>
                                <div class="fw-bold">Level {{ original_values.installment_rate.description }}</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Credit History -->
                <div class="feature-category">
                    <h6 class="category-title">Credit History</h6>
                    <div class="row">
                        <div class="col-md-4 mb-3">
                            <div class="feature-value-card">
                                <small class="text-muted">Credit History</small>
                                <div class="fw-bold">{{ original_values.credit_history.description }}</div>
                            </div>
                        </div>
                        <div class="col-md-4 mb-3">
                            <div class="feature-value-card">
                                <small class="text-muted">Loan Purpose</small>
                                <div class="fw-bold">{{ original_values.purpose.description }}</div>
                            </div>
                        </div>
                        <div class="col-md-2 mb-3">
                            <div class="feature-value-card">
                                <small class="text-muted">Existing Credits</small>
                                <div class="fw-bold">{{ original_values.existing_credits.description }}</div>
                            </div>
                        </div>
                        <div class="col-md-2 mb-3">
                            <div class="feature-value-card">
                                <small class="text-muted">Other Debtors</small>
                                <div class="fw-bold">{{ original_values.debtors.description }}</div>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-4 offset-md-4 mb-3">
                            <div class="feature-value-card">
                                <small class="text-muted">Other Plans</small>
                                <div class="fw-bold">{{ original_values.other_plans.description }}</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Housing & Employment -->
                <div class="feature-category">
                    <h6 class="category-title">Housing & Employment</h6>
                    <div class="row">
                        <div class="col-md-3 mb-3">
                            <div class="feature-value-card">
                                <small class="text-muted">Housing</small>
                                <div class="fw-bold">{{ original_values.housing.description }}</div>
                            </div>
                        </div>
                        <div class="col-md-3 mb-3">
                            <div class="feature-value-card">
                                <small class="text-muted">Employment Since</small>
                                <div class="fw-bold">{{ original_values.employment.description }}</div>
                            </div>
                        </div>
                        <div class="col-md-2 mb-3">
                            <div class="feature-value-card">
                                <small class="text-muted">Residence Since</small>
                                <div class="fw-bold">{{ original_values.residence.description }} years</div>
                            </div>
                        </div>
                        <div class="col-md-2 mb-3">
                            <div class="feature-value-card">
                                <small class="text-muted">Property</small>
                                <div class="fw-bold">{{ original_values.property.description }}</div>
                            </div>
                        </div>
                        <div class="col-md-2 mb-3">
                            <div class="feature-value-card">
                                <small class="text-muted">Telephone</small>
                                <div class="fw-bold">{{ original_values.telephone.description }}</div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="alert alert-info mt-4">
                    <i class="fas fa-info-circle me-2"></i>
                    <strong>Note:</strong> This prediction is based on the German Credit Dataset.
                    Actual credit decisions should consider additional factors and regulations.
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
$(document).ready(function() {
    // Animate probability bars
    const goodProb = parseFloat("{{ result.probability_good_raw|default(0.5) }}");
    const badProb = parseFloat("{{ result.probability_bad_raw|default(0.5) }}");

    setTimeout(() => {
        $('#goodProbBar').css('width', (goodProb * 100) + '%');
        $('#badProbBar').css('width', (badProb * 100) + '%');
    }, 500);

    // Add animation to feature cards
    $('.feature-value-card').each(function(index) {
        $(this).hide().delay(100 * index).fadeIn(300);
    });

    // Add hover effects
    $('.feature-value-card').hover(
        function() {
            $(this).css('transform', 'translateY(-5px)');
            $(this).css('box-shadow', '0 5px 15px rgba(0,0,0,0.1)');
        },
        function() {
            $(this).css('transform', 'translateY(0)');
            $(this).css('box-shadow', '0 2px 4px rgba(0,0,0,0.1)');
        }
    );
});
</script>
{% endblock %}